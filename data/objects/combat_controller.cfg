{
	id: "combat_controller",
	is_human: true,
	hitpoints: 4,
	editor_info: { category: "player" },
	hidden_in_game: true,
	animation: [{
		id: "normal",
		image: "cube.png",
		rect: [0,0,15,15],
		collide: [0,0,15,15],
		frames: 1,
		duration: 1000,
	}],
	
	properties: {
		_v_up: [0,1,0],
		_v_target: [16,1,16],
		_v_position: [32,16,32],
		_pos_index: 0,
		
		_set_char_rotation_l: "def(decimal ratio) -> commands
			set(level.chars[1].rotate_y, mod(level.chars[1].rotate_y-90.0*ratio,360))
		",
		_set_char_rotation_r: "def(decimal ratio) -> commands
			set(level.chars[1].rotate_y, mod(level.chars[1].rotate_y + ratio*90, 360))
		",
		
		_set_cam_rotation_l: "def(decimal ratio) -> commands
			lookat(level.camera, switch(_pos_index, 
				0, [32.0-32.0*ratio, 16, 32],
				1, [ 0, 16, 32.0-32.0*ratio],
				2, [32.0*ratio, 16,  0],
				3, [32, 16,  32.0*ratio]
			), _v_target, _v_up)
		",
		_set_cam_rotation_r: "def(decimal ratio) -> commands
			lookat(level.camera, switch(_pos_index, 
				0, [32, 16, 32.0-32.0*ratio],
				1, [32.0*ratio, 16, 32],
				2, [0, 16,  32.0*ratio],
				3, [32.0-32.0*ratio, 16, 0]
			), _v_target, _v_up)
		",
	},
	
	is_strict: true,
	
	//on_key_press_a: "set(level.camera.position, Vec3<- zip(level.camera.position, map(level.camera.right, value * 10.0 * level.camera.speed), a-b))",
	//on_key_press_d: "set(level.camera.position, Vec3<- zip(level.camera.position, map(level.camera.right, value * 10.0 * level.camera.speed), a+b))",
	//on_key_press_s: "set(level.camera.position, Vec3<- zip(level.camera.position, map(level.camera.direction, value * 10.0 * level.camera.speed), a-b))",
	//on_key_press_w: "set(level.camera.position, Vec3<- zip(level.camera.position, map(level.camera.direction, value * 10.0 * level.camera.speed), a+b))",
	on_key_press_s: "add(level.chars[1].tz,0.5)",
	on_key_press_w: "add(level.chars[1].tz,-0.5)",
	on_key_press_a: "add(level.chars[1].tx,-0.5)",
	on_key_press_d: "add(level.chars[1].tx,0.5)",
	
	"on_key_press_1073741911": "add(level.camera.fov,0.5)",
	"on_key_press_1073741910": "add(level.camera.fov,-0.5)",
	
	on_key_press_f: "set(level.chars[1].tx,1)",
	on_key_press_g: "set(level.chars[1].tx,16)",
	on_key_press_1: "set(level.mouselook, true)",
	on_key_press_2: "set(level.mouselook, false)",
	on_key_press_3: "set(level.chars[1].rotate, 0)",
	on_key_press_4: "add(level.chars[1].rotate, 15)",
	on_key_press_5: "set(level.chars[1].rotate_x, 0)",
	on_key_press_6: "add(level.chars[1].rotate_x, 15)",
	on_key_press_7: "set(level.chars[1].rotate_y, 0)",
	on_key_press_8: "add(level.chars[1].rotate_y, 15)",
	on_process: "map(['w','a','s','d','f','g','1','2','3','4','5','6','7','8',1073741911,1073741910], if(value in level.player.ctrl_keys, fire_event('key_press_' + value)))",
	
	//on_ctrl_left:  "[lookat(level.camera, [0,16,32], v_target, v_up), set(level.chars[1].rotate_y, 315)]",
	//on_ctrl_right: "[lookat(level.camera, [0,16,0], v_target, v_up), set(level.chars[1].rotate_y, 45)]",
	//on_ctrl_up:    "[lookat(level.camera, [32,16,32], v_target, v_up), set(level.chars[1].rotate_y, 45)]",
	//on_ctrl_down:  "[lookat(level.camera, [32,16,0], v_target, v_up), set(level.chars[1].rotate_y, 315)]",
	
	on_ctrl_left:  "[set(_pos_index, mod(_pos_index+1,4)), 
		[schedule(f,[_set_char_rotation_l(f/25.0), _set_cam_rotation_l(f/25.0)]) | f<-range(26)]]
	",
	
	on_ctrl_right: "[set(_pos_index, mod(_pos_index-1,4)), 
		[schedule(f,[_set_char_rotation_r(f/25.0), _set_cam_rotation_r(f/25.0)]) | f<-range(26)]]
	",
	
	on_create: "[
		// console_output_to_screen(false), 
		fire_event('window_resize', {width: level.camera_position[2], height: level.camera_position[3]}),
		if(grounds and grounds.flat_plane, set(level.isomap, grounds.flat_plane)),
		
		//set(level.mouselook, true),
		
		spawn('fighter',0,0,{rotate_y:45, tx:16, ty:2.5, tz:16}),
		lookat(level.camera, _v_position, _v_target, _v_up),
		
	] where grounds = get_document('data/battlegrounds.cfg')",
	
	on_window_resize: "[
		set(level.dimensions, [0, 0, arg.width, arg.height]),
	]",
}